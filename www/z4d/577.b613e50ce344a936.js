"use strict";(self.webpackChunkz4d_plugin=self.webpackChunkz4d_plugin||[]).push([[577],{74577:(B,m,s)=>{s.r(m),s.d(m,{GroupModule:()=>X});var p=s(89417),h=s(93887),F=s(93331),g=s(38117),_=s(12298),f=s(28990),t=s(54438),G=s(88652),b=s(3366),d=s(19664),I=s(45794),j=s(38852),E=s(97013),c=s(46247),v=s(5779),k=s(22242);const C=["content"],N=()=>["_GroupId","GroupName"],T=()=>[10,25,50];function S(i,l){if(1&i){const e=t.RV6();t.EFF(0,"\n          "),t.j41(1,"div",12),t.EFF(2,"\n            "),t.j41(3,"span",13),t.EFF(4,"\n              "),t.nrm(5,"i",14),t.EFF(6,"\n              "),t.j41(7,"input",15),t.nI1(8,"translate"),t.bIt("input",function(o){t.eBV(e),t.XpG();const r=t.sdS(16);return t.Njj(r.filterGlobal(o.target.value,"contains"))}),t.k0s(),t.EFF(9,"\n            "),t.k0s(),t.EFF(10,"\n            "),t.j41(11,"button",16),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.add())}),t.k0s(),t.EFF(12,"\n          "),t.k0s(),t.EFF(13,"\n        ")}2&i&&(t.R7$(7),t.FS9("placeholder",t.bMT(8,1,"device.byname.placeholder")))}function w(i,l){1&i&&(t.EFF(0,"\n          "),t.j41(1,"tr"),t.EFF(2,"\n            "),t.nrm(3,"th"),t.EFF(4,"\n            "),t.j41(5,"th",17),t.EFF(6),t.nI1(7,"translate"),t.nrm(8,"p-sortIcon",18),t.EFF(9,"\n            "),t.k0s(),t.EFF(10,"\n            "),t.j41(11,"th",19),t.EFF(12),t.nI1(13,"translate"),t.nrm(14,"p-sortIcon",20),t.EFF(15,"\n            "),t.k0s(),t.EFF(16,"\n            "),t.j41(17,"th"),t.EFF(18),t.nI1(19,"translate"),t.k0s(),t.EFF(20,"\n            "),t.j41(21,"th"),t.EFF(22),t.nI1(23,"translate"),t.k0s(),t.EFF(24,"\n          "),t.k0s(),t.EFF(25,"\n        ")),2&i&&(t.R7$(6),t.SpI("\n              ",t.bMT(7,4,"group.create.shortid.column"),""),t.R7$(6),t.SpI("\n              ",t.bMT(13,6,"group.create.groupname.column"),""),t.R7$(6),t.SpI("\n              ",t.bMT(19,8,"group.create.devices.column"),"\n            "),t.R7$(4),t.SpI("\n              ",t.bMT(23,10,"group.create.coordinator.column"),"\n            "))}function R(i,l){if(1&i){const e=t.RV6();t.EFF(0,"\n                  "),t.j41(1,"input",29),t.mxI("ngModelChange",function(o){t.eBV(e);const r=t.XpG().$implicit;return t.DH7(r.GroupName,o)||(r.GroupName=o),t.Njj(o)}),t.bIt("change",function(o){t.eBV(e);const r=t.XpG().$implicit,a=t.XpG();return t.Njj(a.updateValue(o,r._GroupId))}),t.k0s(),t.EFF(2,"\n                ")}if(2&i){const e=t.XpG().$implicit;t.R7$(),t.R50("ngModel",e.GroupName)}}function $(i,l){if(1&i){const e=t.RV6();t.EFF(0,"\n                  "),t.j41(1,"input",29),t.mxI("ngModelChange",function(o){t.eBV(e);const r=t.XpG().$implicit;return t.DH7(r.GroupName,o)||(r.GroupName=o),t.Njj(o)}),t.bIt("change",function(o){t.eBV(e);const r=t.XpG().$implicit,a=t.XpG();return t.Njj(a.updateValue(o,r._GroupId))}),t.k0s(),t.EFF(2,"\n                ")}if(2&i){const e=t.XpG().$implicit;t.R7$(),t.R50("ngModel",e.GroupName)}}function M(i,l){if(1&i&&(t.EFF(0,"\n                  "),t.j41(1,"span"),t.EFF(2,"\n                    "),t.j41(3,"b"),t.EFF(4,"Widget"),t.k0s(),t.EFF(5),t.j41(6,"b"),t.EFF(7,"IEEE"),t.k0s(),t.EFF(8),t.j41(9,"b"),t.EFF(10,"Ep"),t.k0s(),t.EFF(11),t.j41(12,"b"),t.EFF(13,"Id"),t.k0s(),t.EFF(14),t.j41(15,"b"),t.EFF(16),t.k0s(),t.EFF(17,"\n                  "),t.k0s(),t.EFF(18,"\n                ")),2&i){const e=l.item;t.R7$(5),t.SpI(" : ",e.Name," - "),t.R7$(3),t.SpI(" : ",e.IEEE," - "),t.R7$(3),t.SpI(" : ",e.Ep," -\n                    "),t.R7$(3),t.SpI(" : ",e._ID," -\n                    "),t.R7$(2),t.JRh(e.ZDeviceName)}}function y(i,l){if(1&i){const e=t.RV6();t.EFF(0,"\n          "),t.j41(1,"tr"),t.EFF(2,"\n            "),t.j41(3,"td"),t.EFF(4,"\n              "),t.j41(5,"i",21),t.nI1(6,"translate"),t.bIt("click",function(){const o=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.delete(o))}),t.k0s(),t.EFF(7,"\n            "),t.k0s(),t.EFF(8,"\n            "),t.j41(9,"td"),t.EFF(10),t.k0s(),t.EFF(11,"\n            "),t.j41(12,"td",22),t.EFF(13,"\n              "),t.j41(14,"p-cellEditor"),t.EFF(15,"\n                "),t.DNE(16,R,3,1,"ng-template",23),t.EFF(17,"\n                "),t.DNE(18,$,3,1,"ng-template",24),t.EFF(19,"\n              "),t.k0s(),t.EFF(20,"\n            "),t.k0s(),t.EFF(21,"\n            "),t.j41(22,"td"),t.EFF(23,"\n              "),t.j41(24,"ng-select",25),t.mxI("ngModelChange",function(o){const r=t.eBV(e).$implicit;return t.DH7(r.devicesSelected,o)||(r.devicesSelected=o),t.Njj(o)}),t.bIt("change",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.isFormValid())}),t.EFF(25,"\n                "),t.DNE(26,M,19,5,"ng-template",26),t.EFF(27,"\n              "),t.k0s(),t.EFF(28,"\n            "),t.k0s(),t.EFF(29,"\n            "),t.j41(30,"td"),t.EFF(31,"\n              "),t.j41(32,"div",27),t.EFF(33,"\n                "),t.j41(34,"input",28),t.bIt("click",function(o){const r=t.eBV(e).$implicit,a=t.XpG();return t.Njj(a.updateCoordinator(o,r))}),t.k0s(),t.EFF(35,"\n              "),t.k0s(),t.EFF(36,"\n            "),t.k0s()()}if(2&i){const e=l.$implicit,n=t.XpG();t.R7$(5),t.FS9("title",t.bMT(6,9,"group.create.delete.button")),t.R7$(5),t.SpI("\n              ",e._GroupId,"\n            "),t.R7$(2),t.Y8G("pEditableColumn",e.GroupName),t.R7$(12),t.Y8G("items",n.devices)("multiple",!0)("closeOnSelect",!1)("searchable",!0),t.R50("ngModel",e.devicesSelected),t.R7$(10),t.Y8G("checked",e.coordinatorInside)}}function V(i,l){if(1&i){const e=t.RV6();t.EFF(0,"\n    "),t.j41(1,"div",30),t.EFF(2,"\n      "),t.nrm(3,"h4",31),t.EFF(4,"\n      "),t.j41(5,"button",32),t.bIt("click",function(){const o=t.eBV(e).$implicit;return t.Njj(o.dismiss("Cross click"))}),t.k0s(),t.EFF(6,"\n    "),t.k0s(),t.EFF(7,"\n    "),t.nrm(8,"div",33),t.EFF(9,"\n    "),t.j41(10,"div",34),t.EFF(11,"\n      "),t.j41(12,"button",35),t.bIt("click",function(){const o=t.eBV(e).$implicit;return t.Njj(o.dismiss("cancel"))}),t.k0s(),t.EFF(13,"\n    "),t.k0s(),t.EFF(14,"\n  ")}}const x=[{path:"",component:(()=>{class i extends f.U{modalService;apiService;formBuilder;translate;toastr;headerService;content;form;rows=[];rowsTemp=[];devices;temp=[];hasEditing=!1;waiting=!1;constructor(e,n,o,r,a,u){super(),this.modalService=e,this.apiService=n,this.formBuilder=o,this.translate=r,this.toastr=a,this.headerService=u}ngOnInit(){this.apiService.getZGroupDevicesAvalaible().subscribe(e=>{const n=[];e&&e.length>0&&(e.forEach(o=>{o.WidgetList.forEach(r=>{if("0000"!==o._NwkId){const a=new _.ij;a.Ep=r.Ep,a.IEEE=r.IEEE,a.Name=r.Name,a.ZDeviceName=r.ZDeviceName,a._ID=r._ID,a._NwkId=o._NwkId,n.push(a)}})}),this.devices=[...n],this.getGroups())})}updateValue(e,n){this.hasEditing=!0,this.rows.find(r=>r._GroupId===n).GroupName=e.target.value}updateDevices(){this.rows.forEach(e=>{e.coordinatorInside&&(e.devicesSelected||(e.devicesSelected=[]),e.devicesSelected.push({Ep:"01",_NwkId:"0000"}))}),this.isFormValid&&this.apiService.putZGroups(this.rows).subscribe(()=>{this.hasEditing=!1,this.toastr.success(this.translate.instant("api.global.succes.saved.notify")),this.apiService.getRestartNeeded().subscribe(e=>{1===e.RestartNeeded&&(this.headerService.setRestart(!0),this.open(this.content))}),this.waiting=!0,setTimeout(()=>{this.getGroups(),this.waiting=!1},1e3)})}delete(e){const n=this.rows.indexOf(e,0);n>-1&&(this.rows.splice(n,1),this.rows=[...this.rows],this.temp=[...this.rows])}add(){const e=new _.YJ;e.GroupName="",e.coordinatorInside=!1,this.rows.push(e),this.rows=[...this.rows],this.temp=[...this.rows]}updateCoordinator(e,n){n.coordinatorInside=e.currentTarget.checked}open(e){this.modalService.open(e,{ariaLabelledBy:"modal-basic-title"}).result.then()}isFormValid(){let e=!0;return this.rows.forEach(n=>{n.GroupName&&(n.coordinatorInside||n.devicesSelected&&0!==n.devicesSelected.length)||(e=!1)}),!this.waiting&&e}getGroups(){this.apiService.getZGroups().subscribe(e=>{e&&e.length>0&&(e.forEach(n=>{const o=[];n.coordinatorInside=!1,n.Devices.forEach(r=>{if("0000"===r._NwkId)n.coordinatorInside=!0;else{const a=this.devices.find(u=>u._NwkId===r._NwkId&&u.Ep===r.Ep);null!=a&&o.push(a)}}),n.devicesSelected=o}),this.rows=[...e],this.temp=[...e])})}static \u0275fac=function(n){return new(n||i)(t.rXU(G.Bq),t.rXU(b.G),t.rXU(p.ok),t.rXU(d.c$),t.rXU(I.tw),t.rXU(j.d))};static \u0275cmp=t.VBU({type:i,selectors:[["app-group"]],viewQuery:function(n,o){if(1&n&&t.GBs(C,5),2&n){let r;t.mGM(r=t.lsd())&&(o.content=r.first)}},features:[t.Vt3],decls:32,vars:20,consts:[["dt1",""],["content",""],[1,"card"],[1,"card-header","fw-bold"],["translate","group.create.validate.button",1,"btn","btn-primary","float-end",3,"click","disabled"],[1,"card-body"],[1,"card-text",3,"innerHTML"],[1,"card-text"],["styleClass","p-datatable-sm","dataKey","_GroupId","responsiveLayout","scroll","stateStorage","local","stateKey","group",3,"globalFilterFields","rowHover","showCurrentPageReport","currentPageReportTemplate","rowsPerPageOptions","value","rows","paginator","scrollable"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"d-flex","justify-content-between"],[1,"p-input-icon-left","ml-auto"],[1,"pi","pi-search"],["pInputText","","type","text",1,"w-75",3,"input","placeholder"],["translate","group.create.add.button",1,"btn","btn-primary",3,"click"],["pSortableColumn","_GroupId",2,"width","8rem"],["field","_GroupId"],["pSortableColumn","GroupName",2,"width","10rem"],["field","GroupName"],[1,"fa","fa-trash",2,"cursor","pointer",3,"click","title"],["pEditableColumnField","GroupName",3,"pEditableColumn"],["pTemplate","input"],["pTemplate","output"],["bindLabel","Name","placeholder","Choose device","appendTo","body",3,"ngModelChange","change","items","multiple","closeOnSelect","searchable","ngModel"],["ng-option-tmp",""],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","checked"],["pInputText","","type","text",3,"ngModelChange","change","ngModel"],[1,"modal-header"],["id","modal-basic-title","translate","group.reloadplugin.alert.title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["translate","group.reloadplugin.alert.subject",1,"modal-body"],[1,"modal-footer"],["type","button","translate","group.reloadplugin.alert.cancel",1,"btn","btn-outline-dark",3,"click"]],template:function(n,o){if(1&n){const r=t.RV6();t.j41(0,"div",2),t.EFF(1,"\n  "),t.j41(2,"div",3),t.EFF(3),t.nI1(4,"translate"),t.j41(5,"button",4),t.bIt("click",function(){return t.eBV(r),t.Njj(o.updateDevices())}),t.k0s(),t.EFF(6,"\n  "),t.k0s(),t.EFF(7,"\n  "),t.j41(8,"div",5),t.EFF(9,"\n    "),t.nrm(10,"p",6),t.nI1(11,"translate"),t.EFF(12,"\n    "),t.j41(13,"div",7),t.EFF(14,"\n      "),t.j41(15,"p-table",8,0),t.nI1(17,"translate"),t.EFF(18,"\n        "),t.DNE(19,S,14,3,"ng-template",9),t.EFF(20,"\n        "),t.DNE(21,w,26,12,"ng-template",10),t.EFF(22,"\n        "),t.DNE(23,y,37,11,"ng-template",11),t.EFF(24,"\n      "),t.k0s(),t.EFF(25,"\n    "),t.k0s(),t.EFF(26,"\n  "),t.k0s(),t.EFF(27,"\n\n  "),t.DNE(28,V,15,0,"ng-template",null,1,t.C5r),t.EFF(30,"\n"),t.k0s(),t.EFF(31,"\n")}2&n&&(t.R7$(3),t.SpI("\n    ",t.bMT(4,12,"group.create.header"),""),t.R7$(2),t.Y8G("disabled",!o.isFormValid()),t.R7$(5),t.Y8G("innerHTML",t.bMT(11,14,"group.create.subtitle"),t.npT),t.R7$(5),t.FS9("currentPageReportTemplate",t.bMT(17,16,"TOTAL")),t.Y8G("globalFilterFields",t.lJ4(18,N))("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",t.lJ4(19,T))("value",o.rows)("rows",10)("paginator",!0)("scrollable",!0))},dependencies:[p.me,p.BC,p.vS,E.vr,E.Uq,d.Mm,c.XI,v.Ei,c.Tg,c.hp,c.c5,c.yc,k.S,d.D9]})}return i})(),data:{title:(0,g.o6)("group")}}];let D=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=t.$C({type:i});static \u0275inj=t.G2t({imports:[F.iI.forChild(x),F.iI]})}return i})(),X=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=t.$C({type:i});static \u0275inj=t.G2t({imports:[D,h.G,p.YN]})}return i})()}}]);